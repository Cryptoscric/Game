<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Wonder Boxer – Platform Fix</title>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: sans-serif;
    color: #fff;
  }

  #game-container {
    position: relative;
    width: 900px;
    height: 450px;
    overflow: hidden;
    border: 3px solid #fff;
    background: linear-gradient(#87ceeb 0%, #87ceeb 60%, #3b2f1b 60%, #3b2f1b 100%);
  }

  #level {
    position: relative;
    width: 2400px;
    height: 100%;
  }

  .ground {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 2400px;
    height: 90px;
    background: #4b3a22;
  }

  .platform {
    position: absolute;
    width: 140px;
    height: 22px;
    background: #6b4b2a;
    border-radius: 4px;
  }

  /* PLAYER */
  #player {
    position: absolute;
    width: 80px;
    height: 110px;

    background-image: url("boxer.png");
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;

    transform-origin: center;
    z-index: 10;
  }

  .enemy, .boss {
    position: absolute;
    width: 48px;
    height: 48px;
    background: #000;
    border-radius: 50%;
  }

  .boss {
    width: 80px;
    height: 80px;
    background: #550000;
    border: 3px solid #ff0000;
  }

  .coin {
    position: absolute;
    width: 24px;
    height: 24px;
    background: gold;
    border-radius: 50%;
    border: 2px solid #fff;
  }

  .powerup {
    position: absolute;
    width: 40px;
    height: 20px;
    background: #00e0ff;
    border-radius: 10px;
    border: 2px solid #fff;
  }

  #hud, #lives, #boss-hp, #controls {
    position: absolute;
    text-shadow: 1px 1px 2px #000;
  }

  #hud { top: 8px; left: 8px; }
  #lives { top: 8px; right: 8px; }
  #boss-hp { top: 30px; right: 8px; }
  #controls { bottom: 8px; left: 8px; font-size: 12px; }
</style>
</head>

<body>
<div id="game-container">
  <div id="hud">Monete: 0</div>
  <div id="lives">Vite: ❤️❤️❤️</div>
  <div id="boss-hp">Boss: 10</div>
  <div id="controls">← → muovi • SPAZIO salta • X colpisci</div>

  <div id="level">

    <div class="ground"></div>

    <!-- PLAYER -->
    <div id="player"></div>

    <!-- PIATTAFORME -->
    <div class="platform" style="left: 260px; bottom: 190px;"></div>
    <div class="platform" style="left: 460px; bottom: 250px;"></div>
    <div class="platform" style="left: 700px; bottom: 190px;"></div>
    <div class="platform" style="left: 950px; bottom: 230px;"></div>
    <div class="platform" style="left: 1200px; bottom: 200px;"></div>
    <div class="platform" style="left: 1500px; bottom: 260px;"></div>
    <div class="platform" style="left: 1800px; bottom: 220px;"></div>

    <!-- NEMICO -->
    <div class="enemy" id="enemy1" style="left: 600px; bottom: 90px;"></div>

    <!-- POWER-UP -->
    <div class="powerup" id="skate" style="left: 850px; bottom: 100px;"></div>

    <!-- MONETE -->
    <div class="coin" style="left: 300px; bottom: 210px;"></div>
    <div class="coin" style="left: 480px; bottom: 270px;"></div>
    <div class="coin" style="left: 730px; bottom: 210px;"></div>
    <div class="coin" style="left: 980px; bottom: 250px;"></div>
    <div class="coin" style="left: 1250px; bottom: 220px;"></div>
    <div class="coin" style="left: 1550px; bottom: 280px;"></div>
    <div class="coin" style="left: 1850px; bottom: 240px;"></div>
    <div class="coin" style="left: 2100px; bottom: 200px;"></div>

    <!-- BOSS -->
    <div class="boss" id="boss" style="left: 2150px; bottom: 90px;"></div>

  </div>
</div>

<script>
/* -------------------------
   VARIABILI DI GIOCO
------------------------- */
const container = document.getElementById("game-container");
const level = document.getElementById("level");
const player = document.getElementById("player");
const platforms = [...document.getElementsByClassName("platform")];
const coins = [...document.getElementsByClassName("coin")];
const enemy1 = document.getElementById("enemy1");
const boss = document.getElementById("boss");

let playerX = 100;
let playerY = 90;
let velX = 0;
let velY = 0;
let onGround = false;
let facing = 1;

const gravity = 0.6;
let moveSpeed = 3.2;
const jumpStrength = 11;

let score = 0;
let lives = 3;
let bossHP = 10;

let keys = { left: false, right: false, jump: false, attack: false };

/* -------------------------
   INPUT
------------------------- */
window.addEventListener("keydown", e => {
  const k = e.key.toLowerCase();
  if (k === "arrowleft") keys.left = true;
  if (k === "arrowright") keys.right = true;
  if (k === " ") keys.jump = true;
  if (k === "x") keys.attack = true;
});

window.addEventListener("keyup", e => {
  const k = e.key.toLowerCase();
  if (k === "arrowleft") keys.left = false;
  if (k === "arrowright") keys.right = false;
  if (k === " ") keys.jump = false;
  if (k === "x") keys.attack = false;
});

/* -------------------------
   COLLISIONE PIATTAFORME
------------------------- */
function checkPlatformCollision() {
  onGround = false;

  for (const p of platforms) {
    const px = parseInt(p.style.left);
    const py = parseInt(p.style.bottom);
    const pw = p.offsetWidth;
    const ph = p.offsetHeight;

    const playerW = player.offsetWidth;
    const playerH = player.offsetHeight;

    const horizontally =
      playerX + playerW > px &&
      playerX < px + pw;

    const falling = velY < 0;

    const abovePlatform =
      playerY >= py + ph - 5;

    if (horizontally && falling && abovePlatform) {
      if (playerY + velY <= py + ph) {
        playerY = py + ph;
        velY = 0;
        onGround = true;
      }
    }
  }
}

/* -------------------------
   UPDATE PLAYER
------------------------- */
function updatePlayer() {
  velX = 0;
  if (keys.left) { velX = -moveSpeed; facing = -1; }
  if (keys.right) { velX = moveSpeed; facing = 1; }

  if (keys.jump && onGround) {
    velY = jumpStrength;
    onGround = false;
  }

  velY -= gravity;

  playerX += velX;
  playerY += velY;

  if (playerY <= 90) {
    playerY = 90;
    velY = 0;
    onGround = true;
  }

  checkPlatformCollision();

  player.style.left = playerX + "px";
  player.style.bottom = playerY + "px";
  player.style.transform = facing === -1 ? "scaleX(-1)" : "scaleX(1)";

  container.scrollLeft = playerX - container.clientWidth / 2;
}

/* -------------------------
   GAME LOOP
------------------------- */
function gameLoop() {
  updatePlayer();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
